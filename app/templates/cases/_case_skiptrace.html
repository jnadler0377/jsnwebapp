{# templates/cases/_case_skiptrace.html #}

<section class="skip-trace-section">
  <h3>Skip Trace</h3>
  {% if skip_trace_error %}
    <p class="error-text">{{ skip_trace_error }}</p>
  {% endif %}

  {% if skip_trace %}
    {% set results = skip_trace.results if skip_trace.results is defined else [] %}
    {% if results and results|length > 0 %}
      {% set r = results[0] %}
      {% set persons = r.persons if r.persons is defined else [] %}
      {% set person = persons[0] if persons and persons|length > 0 else None %}
      {% set addr = r.propertyAddress if r.propertyAddress is defined else {} %}

      {% if person %}
        <p><strong>Owner:</strong> {{ person.full_name or '—' }}</p>

        <p><strong>Phones:</strong>
          {% if person.phones %}
            <ul class="skip-phones">
              {% for ph in person.phones %}
                <li>
                  {{ macros.format_phone(ph.number) }}
                  {% if ph.carrier %} ({{ ph.carrier }}){% endif %}
                  {% if ph.score is not none %} – Score: {{ '%.0f'|format(ph.score) }}{% endif %}
                  <br>
                  Reachable: {{ macros.yn_icon(ph.reachable) }}
                  &nbsp; Tested: {{ macros.yn_icon(ph.tested) }}
                  &nbsp; DNC: {{ macros.yn_icon(ph.dnc) }}
                </li>
              {% endfor %}
            </ul>
          {% else %}
            —
          {% endif %}
        </p>

        <p><strong>Emails:</strong>
          {% if person.emails %}
            {% for em in person.emails %}
              {{ em.email }}{% if not loop.last %}, {% endif %}
            {% endfor %}
          {% else %}
            —
          {% endif %}
        </p>

        <p><strong>Property Address (from skip trace):</strong>
          {% if addr and (addr.street or addr.city or addr.state or addr.postalCode) %}
            {{ addr.street }},
            {{ addr.city }},
            {{ addr.state }}
            {{ addr.postalCode }}
          {% else %}
            —
          {% endif %}
        </p>
      {% else %}
        <p>No skip trace person data.</p>
      {% endif %}
    {% else %}
      <p>No skip trace results.</p>
    {% endif %}
  {% else %}
    <p>No skip trace data. Use “Skip Trace Owner” to pull BatchData skip trace.</p>
  {% endif %}
</section>
